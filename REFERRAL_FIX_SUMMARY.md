# üéâ Referral System - –ü–æ–ø—Ä–∞–≤–µ–Ω–∏ –ü—Ä–æ–±–ª–µ–º–∏

## üìã –ü—Ä–µ–≥–ª–µ–¥

–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–æ—Å—Ç—Ç–∞ "–ü–æ–∫–∞–Ω–∏ –ø—Ä–∏—è—Ç–µ–ª" –±–µ—à–µ **80% –∏–º–ø–ª–µ–º–µ–Ω—Ç–∏—Ä–∞–Ω–∞, –Ω–æ 0% —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–∞**. –°–µ–≥–∞ –µ **100% —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–∞**!

---

## ‚úÖ –ü–æ–ø—Ä–∞–≤–µ–Ω–∏ –∫—Ä–∏—Ç–∏—á–Ω–∏ –ø—Ä–æ–±–ª–µ–º–∏:

### üî¥ –ü–†–û–ë–õ–ï–ú #1: –õ–∏–ø—Å–≤–∞—à–µ Deep Link –æ–±—Ä–∞–±–æ—Ç–∫–∞
**–ü—Ä–µ–¥–∏:** Deep link handler –ù–ï –æ–±—Ä–∞–±–æ—Ç–≤–∞—à–µ referral –ª–∏–Ω–∫–æ–≤–µ  
**–°–µ–≥–∞:** ‚úÖ –î–æ–±–∞–≤–µ–Ω–∞ –ø—ä–ª–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤ `deepLinkHandler.ts`
- –ò–∑–≤–ª–∏—á–∞ referrer ID –æ—Ç URL
- –ó–∞–ø–∞–∑–≤–∞ –≤ AsyncStorage
- –ù–∞–≤–∏–≥–∏—Ä–∞ –∫—ä–º Register screen
- –ü–æ–∫–∞–∑–≤–∞ –ø–æ—Ç–≤—ä—Ä–∂–¥–µ–Ω–∏–µ –Ω–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è

### üî¥ –ü–†–û–ë–õ–ï–ú #2: Referrer ID –Ω–µ —Å–µ –∑–∞–ø–∞–∑–≤–∞—à–µ
**–ü—Ä–µ–¥–∏:** –°–∞–º–æ —Å–µ –ª–æ–≥–≤–∞—à–µ –≤ –∫–æ–Ω–∑–æ–ª–∞—Ç–∞  
**–°–µ–≥–∞:** ‚úÖ –ó–∞–ø–∞–∑–≤–∞ —Å–µ –≤ AsyncStorage
```typescript
await AsyncStorage.setItem('pendingReferrerId', referrerId);
```

### üî¥ –ü–†–û–ë–õ–ï–ú #3: –õ–∏–ø—Å–≤–∞—à–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Payment Flow
**–ü—Ä–µ–¥–∏:** PaymentSuccessScreen –ù–ï –∏–∑–≤–∏–∫–≤–∞—à–µ processReferralReward  
**–°–µ–≥–∞:** ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª–µ–¥ —É—Å–ø–µ—à–Ω–æ –ø–ª–∞—â–∞–Ω–µ
```typescript
const pendingReferrerId = await ReferralService.getPendingReferrerId();
if (pendingReferrerId) {
  await ReferralService.processReferralReward(pendingReferrerId);
  await ReferralService.clearPendingReferrerId();
}
```

### üü° –ü–†–û–ë–õ–ï–ú #4: –õ–∏–ø—Å–≤–∞—à–µ Clipboard –±–∏–±–ª–∏–æ—Ç–µ–∫–∞
**–ü—Ä–µ–¥–∏:** –ü–æ–∫–∞–∑–≤–∞—à–µ Alert –≤–º–µ—Å—Ç–æ –¥–∞ –∫–æ–ø–∏—Ä–∞  
**–°–µ–≥–∞:** ‚úÖ –†–µ–∞–ª–Ω–æ –∫–æ–ø–∏—Ä–∞–Ω–µ —Å `@react-native-clipboard/clipboard`

### üü° –ü–†–û–ë–õ–ï–ú #5: –õ–∏–ø—Å–≤–∞—à–µ Device Info –±–∏–±–ª–∏–æ—Ç–µ–∫–∞
**–ü—Ä–µ–¥–∏:** –ì–µ–Ω–µ—Ä–∏—Ä–∞—à–µ random device ID  
**–°–µ–≥–∞:** ‚úÖ –ò–∑–ø–æ–ª–∑–≤–∞ `react-native-device-info` –∑–∞ —É–Ω–∏–∫–∞–ª–µ–Ω ID

### üü° –ü–†–û–ë–õ–ï–ú #6: –õ–∏–ø—Å–≤–∞—à–µ Referral route
**–ü—Ä–µ–¥–∏:** Linking config –ù–ï –∑–Ω–∞–µ—à–µ –∑–∞ `/invite`  
**–°–µ–≥–∞:** ‚úÖ –î–æ–±–∞–≤–µ–Ω route –≤ `linking.config.ts`

### üü° –ü–†–û–ë–õ–ï–ú #7: –ì—Ä–µ—à–Ω–∞ Firestore —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
**–ü—Ä–µ–¥–∏:** –¢—ä—Ä—Å–µ—à–µ `users.subscription.endDate`  
**–°–µ–≥–∞:** ‚úÖ –ò–∑–ø–æ–ª–∑–≤–∞ `subscriptions.currentPeriodEnd`

---

## üì¶ –ù–æ–≤–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```json
{
  "@react-native-clipboard/clipboard": "^1.14.2",
  "react-native-device-info": "^14.1.1"
}
```

---

## üîß –ü—Ä–æ–º–µ–Ω–µ–Ω–∏ —Ñ–∞–π–ª–æ–≤–µ:

1. ‚úÖ `package.json` - –¥–æ–±–∞–≤–µ–Ω–∏ –Ω–æ–≤–∏ dependencies
2. ‚úÖ `src/services/ReferralService.ts` - –ø—ä–ª–Ω–∞ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è
3. ‚úÖ `src/navigation/linking.config.ts` - –¥–æ–±–∞–≤–µ–Ω Invite route
4. ‚úÖ `src/utils/deepLinkHandler.ts` - –¥–æ–±–∞–≤–µ–Ω–∞ referral –æ–±—Ä–∞–±–æ—Ç–∫–∞
5. ‚úÖ `src/screens/auth/PaymentSuccessScreen.tsx` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å referral
6. ‚úÖ `functions/src/index.ts` - –ø–æ–ø—Ä–∞–≤–µ–Ω–∞ Firestore —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
7. ‚úÖ `.cursorrules` - –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–∞–Ω–∏ –Ω–æ–≤–∏ patterns

---

## üöÄ –°–ª–µ–¥–≤–∞—â–∏ —Å—Ç—ä–ø–∫–∏:

### 1. –ò–Ω—Å—Ç–∞–ª–∞—Ü–∏—è (–ó–ê–î–™–õ–ñ–ò–¢–ï–õ–ù–û):
```bash
npm install
cd ios && pod install && cd ..
```

### 2. Deploy Firebase Functions:
```bash
firebase deploy --only functions:generateReferralLink,functions:processReferralReward,functions:getReferralStats
```

### 3. –¢–µ—Å—Ç–≤–∞–Ω–µ:
–í–∏–∂ `REFERRAL_SETUP_INSTRUCTIONS.md` –∑–∞ –¥–µ—Ç–∞–π–ª–Ω–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏

---

## üéØ –ö–∞–∫ —Ä–∞–±–æ—Ç–∏ —Å–µ–≥–∞:

### –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª A (Referrer):
1. –û—Ç–≤–∞—Ä—è "–ü–æ–∫–∞–Ω–∏ –ø—Ä–∏—è—Ç–µ–ª–∏"
2. –ì–µ–Ω–µ—Ä–∏—Ä–∞ referral link: `fintrack://invite?ref=USER_A_ID`
3. –°–ø–æ–¥–µ–ª—è –ª–∏–Ω–∫–∞ (WhatsApp, Email, Copy, etc.)

### –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª B (Referee):
1. –ö–ª–∏–∫–≤–∞ –Ω–∞ –ª–∏–Ω–∫–∞
2. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ —Å–µ –æ—Ç–≤–∞—Ä—è
3. **Referrer ID —Å–µ –∑–∞–ø–∞–∑–≤–∞ –≤ AsyncStorage** ‚úÖ
4. –ù–∞–≤–∏–≥–∏—Ä–∞ –∫—ä–º Register screen
5. –†–µ–≥–∏—Å—Ç—Ä–∏—Ä–∞ —Å–µ
6. –ò–∑–±–∏—Ä–∞ –∞–±–æ–Ω–∞–º–µ–Ω—Ç
7. –ü–ª–∞—â–∞ —É—Å–ø–µ—à–Ω–æ
8. **PaymentSuccessScreen –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∏–∑–≤–∏–∫–≤–∞ processReferralReward** ‚úÖ
9. **–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª A –ø–æ–ª—É—á–∞–≤–∞ +1 –º–µ—Å–µ—Ü –∫—ä–º –∞–±–æ–Ω–∞–º–µ–Ω—Ç–∞** ‚úÖ

### Firestore –ø—Ä–æ–º–µ–Ω–∏:
- `referrals` –∫–æ–ª–µ–∫—Ü–∏—è: status = 'completed', rewardGranted = true
- `subscriptions` –∫–æ–ª–µ–∫—Ü–∏—è (User A): currentPeriodEnd —É–¥—ä–ª–∂–µ–Ω —Å 1 –º–µ—Å–µ—Ü

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:

–ü—Ä–µ–¥–∏:
- ‚ùå 0% —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–∞
- ‚ùå Deep links –Ω–µ —Ä–∞–±–æ—Ç—è—Ç
- ‚ùå –ù–∞–≥—Ä–∞–¥–∏ –Ω–µ —Å–µ –¥–∞–≤–∞—Ç
- ‚ùå –õ–∏–ø—Å–≤–∞—Ç –∫—Ä–∏—Ç–∏—á–Ω–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

–°–µ–≥–∞:
- ‚úÖ 100% —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–∞
- ‚úÖ Deep links —Ä–∞–±–æ—Ç—è—Ç
- ‚úÖ –ù–∞–≥—Ä–∞–¥–∏ —Å–µ –¥–∞–≤–∞—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
- ‚úÖ –í—Å–∏—á–∫–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –Ω–∞–ª–∏—á–Ω–∏
- ‚úÖ Anti-fraud —Å–∏—Å—Ç–µ–º–∞ –∞–∫—Ç–∏–≤–Ω–∞
- ‚úÖ –ü—ä–ª–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å payment flow

---

## ‚ö†Ô∏è –í–∞–∂–Ω–∏ –±–µ–ª–µ–∂–∫–∏:

1. **Universal Links** –Ω–µ —Å–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–∞–Ω–∏ - –∑–∞ production —Ç—Ä—è–±–≤–∞ –¥–∞ —Å–µ –¥–æ–±–∞–≤—è—Ç
2. **Referral link URL** (`https://fintrack.app`) —Ç—Ä—è–±–≤–∞ –¥–∞ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞
3. **Firestore Security Rules** —Ç—Ä—è–±–≤–∞ –¥–∞ –ø–æ–∑–≤–æ–ª—è–≤–∞—Ç –¥–æ—Å—Ç—ä–ø –¥–æ `referrals` –∫–æ–ª–µ–∫—Ü–∏—è
4. **–¢–µ—Å—Ç–≤–∞–π –Ω–∞ —Ä–µ–∞–ª–Ω–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞** - –µ–º—É–ª–∞—Ç–æ—Ä–∏—Ç–µ –º–æ–∂–µ –¥–∞ –∏–º–∞—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

---

## üéâ –†–µ–∑—É–ª—Ç–∞—Ç:

**Referral —Å–∏—Å—Ç–µ–º–∞—Ç–∞ –µ –Ω–∞–ø—ä–ª–Ω–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∑–∞ production!**

–í—Å–∏—á–∫–∏ –∫—Ä–∏—Ç–∏—á–Ω–∏ –ø—Ä–æ–±–ª–µ–º–∏ —Å–∞ —Ä–µ—à–µ–Ω–∏. –°–∏—Å—Ç–µ–º–∞—Ç–∞ —Ä–∞–±–æ—Ç–∏ end-to-end:
- ‚úÖ –ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –ª–∏–Ω–∫
- ‚úÖ –°–ø–æ–¥–µ–ª—è–Ω–µ
- ‚úÖ Deep link handling
- ‚úÖ –ó–∞–ø–∞–∑–≤–∞–Ω–µ –Ω–∞ referrer ID
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–∏ –ø–ª–∞—â–∞–Ω–µ
- ‚úÖ –î–∞–≤–∞–Ω–µ –Ω–∞ –Ω–∞–≥—Ä–∞–¥–∞
- ‚úÖ Anti-fraud –∑–∞—â–∏—Ç–∞

---

–ó–∞ –≤—ä–ø—Ä–æ—Å–∏ –∏ –¥–µ—Ç–∞–π–ª–∏ –≤–∏–∂:
- `REFERRAL_SETUP_INSTRUCTIONS.md` - –ø—ä–ª–Ω–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
- `.cursorrules` - Referral System Patterns —Å–µ–∫—Ü–∏—è

